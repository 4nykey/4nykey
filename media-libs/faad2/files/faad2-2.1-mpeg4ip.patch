Index: configure.in
===================================================================
RCS file: /cvsroot/faac/faad2/configure.in,v
retrieving revision 1.29
diff -u -r1.29 configure.in
--- configure.in	17 May 2006 18:49:21 -0000	1.29
+++ configure.in	22 May 2006 13:01:19 -0000
@@ -80,10 +80,10 @@
 
 AC_CHECK_FUNCS(strsep)
 
-AC_CHECK_PROG(external_mp4v2, mpeg4ip-config, yes, no)
+AC_CHECK_PROGS(MPEG4IP_CONFIG, mpeg4ip-config, no)
 AM_CONDITIONAL(HAVE_MPEG4IP_PLUG, false)
 if test x$WITHMPEG4IP = xyes; then
-   if test x$external_mp4v2 = xyes; then
+   if test x$external_mp4v2 != xno; then
       AM_CONDITIONAL(HAVE_MPEG4IP_PLUG, true)
       AC_MSG_NOTICE("Building MPEG4IP plugin")
    else
Index: plugins/mpeg4ip/Makefile.am
===================================================================
RCS file: /cvsroot/faac/faad2/plugins/mpeg4ip/Makefile.am,v
retrieving revision 1.1
diff -u -r1.1 Makefile.am
--- plugins/mpeg4ip/Makefile.am	7 Aug 2003 17:21:21 -0000	1.1
+++ plugins/mpeg4ip/Makefile.am	22 May 2006 12:42:07 -0000
@@ -1,4 +1,4 @@
-libdir = @MPEG4IP_PLAYER_PLUGIN_DIR@
+libdir = `$(MPEG4IP_CONFIG) --player-plugin-dir`
 
 lib_LTLIBRARIES = faad2_plugin.la
 faad2_plugin_la_LDFLAGS = -module
@@ -17,6 +17,6 @@
 
 AM_CFLAGS = -D_REENTRANT -fexceptions 
 
-AM_CXXFLAGS = -D_REENTRANT -DNOCONTROLS -fexceptions 
+AM_CXXFLAGS = -D_REENTRANT -DNOCONTROLS -fexceptions -fpermissive 
 
 
Index: plugins/mpeg4ip/faad2.cpp
===================================================================
RCS file: /cvsroot/faac/faad2/plugins/mpeg4ip/faad2.cpp,v
retrieving revision 1.3
diff -u -r1.3 faad2.cpp
--- plugins/mpeg4ip/faad2.cpp	20 Aug 2004 08:30:53 -0000	1.3
+++ plugins/mpeg4ip/faad2.cpp	22 May 2006 12:30:18 -0000
@@ -239,7 +239,7 @@
                   aac->m_chans,
                   (audio_format_t)AUDIO_S16SYS,
                   aac->m_output_frame_size);
-      uint8_t *now = aac->m_vft->audio_get_buffer(aac->m_ifptr);
+      uint8_t *now = aac->m_vft->audio_get_buffer(aac->m_ifptr,aac->m_current_frame,aac->m_current_time);
       aac->m_audio_inited = 1;
     }
     /*
@@ -322,7 +322,7 @@
   }
   if (userdata != NULL) {
     mpeg4_audio_config_t audio_config;
-    decode_mpeg4_audio_config(userdata, userdata_size, &audio_config);
+    decode_mpeg4_audio_config(userdata, userdata_size, &audio_config, 0);
     message(LOG_DEBUG, "aac", "audio type is %d", audio_config.audio_object_type);
     if (fmtp != NULL) free_fmtp_parse(fmtp);
 
