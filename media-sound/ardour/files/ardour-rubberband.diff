--- ./SConstruct.orig	2012-06-25 20:02:15.000000000 +0300
+++ ./SConstruct	2012-06-26 17:41:40.826672403 +0300
@@ -47,6 +47,7 @@
     BoolVariable('DMALLOC', 'Compile and link using the dmalloc library', 0),
     BoolVariable('EXTRA_WARN', 'Compile with -Wextra, -ansi, and -pedantic.  Might break compilation.  For pedants', 0),
     BoolVariable('FFT_ANALYSIS', 'Include FFT analysis window', 1),
+    BoolVariable('RUBBERBAND', 'Use rubberband instead of soundtouch for timefx', 1),
     BoolVariable('FREESOUND', 'Include Freesound database lookup', 0),
     BoolVariable('FPU_OPTIMIZATION', 'Build runtime checked assembler code', 1),
     BoolVariable('LIBLO', 'Compile with support for liblo library', 1),
@@ -923,11 +924,10 @@
                                  LIBPATH='#libs/vamp-sdk',
                                  CPPPATH='#libs/vamp-sdk')
 
-env['RUBBERBAND'] = False
 
 conf = Configure (env)
 
-if conf.CheckHeader ('fftw3.h'):
+if env['RUBBERBAND'] and conf.CheckHeader ('fftw3.h'):
     env['RUBBERBAND'] = True
     libraries['rubberband'] = LibraryInfo (LIBS='rubberband',
                                            LIBPATH='#libs/rubberband',
@@ -1120,6 +1120,9 @@
 
 #    libraries['flowcanvas'] = LibraryInfo(LIBS='flowcanvas', LIBPATH='#/libs/flowcanvas', CPPPATH='#libs/flowcanvas')
 
+    libraries['rubberband'] = LibraryInfo()
+    libraries['rubberband'].ParseConfig ('pkg-config --cflags --libs rubberband')
+
     libraries['appleutility'] = LibraryInfo(LIBS='libappleutility',
                                             LIBPATH='#libs/appleutility',
                                             CPPPATH='#libs/appleutility')
@@ -1262,6 +1265,9 @@
 timefx_subdirs = []
 if env['RUBBERBAND']:
     timefx_subdirs += ['libs/rubberband']
+    env.Append(CCFLAGS="-DUSE_RUBBERBAND")
+if env['SYSLIBS']:
+    timefx_subdirs = []
 
 #
 # Tools
